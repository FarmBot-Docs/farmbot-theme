{%- assign all_headers_joined = '' -%}

{%- for i in (1..3) -%}
{%- capture header_start -%}<h{{ i }} id="{%- endcapture -%}
{%- assign headers_plus = include.content | split: header_start | slice: 1, 999 -%}
{% capture headers_joined -%}
{%- for header_plus in headers_plus -%}
{%- assign id = header_plus | split: '">' | first -%}
{{ header_start }}{{ id }}">|{{ header_start }}{{ id }}">
<a href="#{{ id }}"><i class="fa fa-anchor"></i></a>%%%
{%- endfor -%}
{%- endcapture -%}
{%- capture all_headers_joined -%}
{{ all_headers_joined }}%%%{{ headers_joined }}
{%- endcapture -%}
{%- endfor -%}

{%- assign content = include.content -%}

{%- assign headers = all_headers_joined | split: '%%%' -%}
{%- for header in headers -%}
{%- assign old = header | split: '|' | first -%}
{%- assign new = header | split: '|' | last -%}
{%- assign content = content | replace: old, new -%}
{%- endfor -%}

{{
content
  | replace: '<th>Â </th>', '<th></th>'
}}
